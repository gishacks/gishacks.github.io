# جلسه 7 دی: گردآوری، آماده‌سازی و سازمان‌دهی داده‌های پایه پروژه‌های شهرسازی

## 1-    داده‌های موردنیاز در پروژه‌های شهرسازی
در پروژه‌های شهرسازی، ما به مجموعه‌ای از داده‌های پایه نیاز داریم که شامل موارد زیر است:
### ·       راه‌ها
### ·       پارسل‌ها
### ·        بلوک‌های جمعیتی
### ·       داده‌های محیطی مانند گسل‌ها
### ·        داده‌های ارتفاعی مانند نقاط ارتفاعی یا DEM

با این حال، داده‌های اصلی و ضروری که حتماً باید در اختیار داشته باشیم عبارت‌اند از:

### ·       راه‌ها
### ·       پارسل‌ها
### ·       بلوک‌های جمعیتی
### ·       نقاط ارتفاعی

## 2-    منابع تهیه داده‌ها
برای تأمین این داده‌ها، دو منبع اصلی در اختیار داریم:
### ·       مرکز آمار ایران
### ·       سازمان نقشه‌برداری کشور
از مرکز آمار می‌توانیم بلوک‌های جمعیتی را دریافت کنیم.
سازمان نقشه‌برداری داده‌ها را عمدتاً به‌صورت فایل‌های CADD ارائه می‌دهد که حاصل دیجیتال‌سازی تصاویر ماهواره‌ای هستند.

**نکات:**
### ·       نقشه‌های ۱:۲۵۰۰۰ سازمان نقشه‌برداری برای مقیاس‌های کلان مناسب‌اند، اما در این مقیاس جزئیاتی مثل درخت‌ها مشخص نیست.
### ·       در شهرسازی معمولاً با مقیاس ۱:۲۰۰۰ کار می‌کنیم و در طراحی شهری مقیاس ۱:۵۰۰ کاربرد دارد.
### ·       برای خرید و دریافت داده‌ها می‌توانیم از سامانه رسا سازمان نقشه‌برداری استفاده کنیم. در پایین صفحه این سامانه لینک‌های «آموزش سامانه» و «معرفی سامانه» وجود دارد که هر دو را باز می‌کنیم تا نحوه استفاده از داده‌ها که توضیح داده شده را یاد بگیریم؛ اما جمع‌آوری داده‌ها از طریق گفته شده قدیمی است و کمتر استفاده می‌شود.

## 3-    مرحله اول پروژه: جمع‌آوری داده‌های موجود
در مرحله اول، تمام داده‌های موجود را جمع‌آوری می‌کنیم؛ مثلاً همان **پایگاه اطلاعات مکانی** که از قبل در اختیار داریم.
سؤال اصلی اینجاست: چطور داده‌هایی که جمع کرده‌ایم را به‌روز کنیم؟

برای این کار:
### ·       فایل راه‌ها
### ·       فایل پارسل‌ها (کاربری‌های موجود)
### ·       فایل بلوک‌های جمعیتی
را به داده‌های خود اضافه می‌کنیم.

## 4-    تعیین محدوده مطالعه (Extent)
در کارگاه ترم بعد، اولین چیزی که از ما می‌خواهند این است که محدوده موردنظر خودمان را مشخص کنیم.

برای این کار:

### ·       فایل مناطق را باز می‌کنیم.
### ·       مثلاً اگر قرار است روی منطقه ۶ کار کنیم، همان منطقه را انتخاب می‌کنیم.
### ·       از منطقه انتخاب‌شده Export می‌گیریم.
### ·        این خروجی را داخل یک Geodatabase ذخیره می‌کنیم و نام آن را extent می‌گذاریم.

**نکته مهم این است که:**
### ·       باید اسم‌های معنادار برای لایه‌ها انتخاب کنیم.
### ·       تمام لایه‌ها باید داخل یک Geodatabase ذخیره شوند.

## 5-    برش لایه‌ها بر اساس محدوده
حالا باید همه داده‌ها را محدود به منطقه ۶ کنیم.
برای این کار از ابزار Select By Location استفاده می‌کنیم و راه‌ها، پارسل‌ها و بلوک‌های جمعیتی را بر اساس extent انتخاب و Export می‌کنیم.

این کار را برای هر لایه انجام می‌دهیم و نام لایه‌ها را دقیق و درست وارد می‌کنیم:
### ·       roads
### ·        parcels
### ·       popblocks

**نکته:**
### ·       موقع Rename کردن نباید فاصله (Space) در اسم لایه‌ها بگذاریم.

در نهایت داخل Geodatabase باید دقیقاً چهار لایه داشته باشیم:
### ·        extent
### ·        roads
### ·       parcels
### ·       popblocks

بعد از اینکه خروجی‌ها را گرفتیم، فقط همین لایه‌های اکسپورت‌شده را نگه می‌داریم و بقیه لایه‌ها را حذف می‌کنیم.

## 6-    به‌روزرسانی داده‌ها با برداشت میدانی
برای به‌روز کردن نقشه‌ها از برداشت میدانی استفاده می‌کنیم.
مبنای برداشت ما پارسل‌ها هستند.

برای برداشت میدانی به دو چیز اصلی نیاز داریم:
### ·       فرم برداشت
### ·       نقشه برداشت

**فرم برداشت**
در فرم برداشت:

### ·       یک کد داریم.
به تعداد اطلاعات موردنیاز ستون تعریف می‌کنیم؛ مثلاً:
### ·       کاربری
### ·       تعداد طبقات
### ·       تعداد واحد
### ·       نما
### ·       کیفیت
فرم را در Word طراحی می‌کنیم، اما بعد از انجام برداشت، برداشتگر باید اطلاعات را داخل Excel وارد کند.

**نقشه برداشت**
برای نقشه برداشت دو حالت داریم:

### ·       یا نقشه خام می‌دهیم و برداشتگر خودش کدگذاری می‌کند.
### ·       یا خود نقشه از قبل کددار است (که گزینه بهتر است).

بهتر است در نقشه برداشت:
### ·       معبرها هم نمایش داده شوند.
### ·       کد معبرها هم مشخص باشد.

## 7-    تهیه نقشه بلوک برای برداشت
برای تهیه نقشه بلوک در ArcGIS Pro مراحل زیر را انجام می‌دهیم:

### ·       در محیط GIS فقط لایه پارسل‌ها را روشن می‌گذاریم.
### ·       جدول توصیفی (Attribute Table) پارسل‌ها را باز می‌کنیم.
### ·       Object ID هر پارسل را به‌عنوان شناسه در نظر می‌گیریم.
### ·       یک فیلد جدید ایجاد می‌کنیم:
### ·       نام فیلد:PID
### ·       نوع داده: Integer (چون Object ID عدد صحیح است)
### ·       مقدار فیلد pid را با Object ID محاسبه (Calculate) می‌کنیم.

## 8-    نمایش کد پارسل‌ها روی نقشه (Labeling)
برای انداختن کد پارسل‌ها روی نقشه:
### ·       روی لایه پارسل‌ها راست‌کلیک می‌کنیم.
### ·       وارد Labeling Properties می‌شویم.
### ·       متن داخل Expression را پاک می‌کنیم و Apply می‌کنیم.
### ·       دوباره روی لایه پارسل‌ها راست‌کلیک می‌کنیم و این بار Label را فعال می‌کنیم.

## 9-   آماده‌سازی نقشه برداشت در Layout

### ·       از تب Insert گزینه New Layout را انتخاب می‌کنیم.
### ·       نقشه را از طریق Map Frame به Layout اضافه می‌کنیم.
### ·       برای اینکه نقشه برای برداشتگر خوانا باشد، مقیاس نقشه را ۱:۱۰۰۰ تنظیم می‌کنیم.

## 10- تهیه نقشه سریالی برای کل منطقه
برای اینکه برداشت کل منطقه ۶ را داشته باشیم:

### ·       از تب Insert وارد Map Series می‌شویم.
### ·       نوع را روی Spatial می‌گذاریم.
### ·       لایه را popblocks انتخاب می‌کنیم.
### ·       فیلد نام‌گذاری را همان ID می‌گذاریم.
### ·       OK را می‌زنیم.

در نهایت،ArcGIS Pro به تعداد بلوک‌های منطقه مدنظر ما، نقشه برداشت جداگانه تولید می‌کند که آماده استفاده در برداشت میدانی هستند.


# جلسه 9 دی: آماده‌سازی داده‌های سازمان نقشه‌برداری برای GIS
وقتی نقشه GIS آماده نداریم چه کار می‌کنیم؟

اگر نقشه GIS آماده نداشته باشیم و بخواهیم از داده‌های سازمان نقشه‌برداری استفاده کنیم، مراحل کار به این صورت است:

## 1-  وارد لینک زیر می‌شویم: (فایل آماده داشتیم)
### ·       transfer.it/t/DAqnm0wFFbYA
### ·       فایل موجود در سایت را دانلود می‌کنیم.
### ·       بعد از استخراج، فایل 39L21Mo2 را باز می‌کنیم.

## 2-  شناخت فایل‌های سازمان نقشه‌برداری
در بین فایل‌ها:
فایل‌هایی که آخر اسمشان p دارد مربوط به:
### ·       پارسل‌ها
### ·       عوارض مصنوع

فایل‌هایی که آخر اسمشان h دارد مربوط به:
### ·       نقاط ارتفاعی
### ·       داده‌های ارتفاعی و مشابه آن

## 3-  باز کردن داده‌ها در AutoCAD

### ·       فایل‌ها را داخل AutoCAD باز می‌کنیم.
### ·       ممکن است هنگام باز شدن یک پیام هشدار بدهد که آن را Ignore می‌کنیم و ادامه می‌دهیم.

## 4-  GIS Ready کردن داده‌ها

برای اینکه داده‌ها قابل استفاده در GIS شوند، باید آن‌ها را GIS Ready کنیم.
این فرآیند دو مرحله اصلی دارد:
### ·       Clean (تمیز کردن)
### ·       Build (ساخت و آماده‌سازی)

## 5-  مرحله اول: Clean (تمیز کردن داده‌ها)
هدف از Clean کردن این است که:
### ·       در هر بلوک فقط پارسل‌ها باقی بمانند.
### ·       هیچ عارضه اضافی داخل بلوک وجود نداشته باشد.

**خاموش یا حذف عوارض اضافی**
در این مرحله:

### ·       عوارض اضافی را خاموش می‌کنیم یا حذف می‌کنیم.
### ·       مثلاً فقط پلاک‌ها را نگه می‌داریم.
مثال: دانشگاه تهران خودش یک پلاک است.

می‌توانیم:
### ·       یک بلوک را انتخاب کنیم.

### ·       فقط همان بلوک را نگه داریم و بقیه را حذف کنیم.

**نکته مهم:**
چون نقشه‌ها ژئورفرنس شده‌اند، نمی‌توانیم آن‌ها را جابه‌جا کنیم.

**استفاده از** **Layoff**
یک راه دیگر برای خاموش کردن لایه‌هایی که نیاز نداریم:
### ·       از دستور LAYOFF استفاده می‌کنیم.
### ·       لایه‌های غیرضروری را خاموش می‌کنیم.

**حذف هچ‌ها**
تمام Hatchها را پاک می‌کنیم.
هچ‌ها در GIS به درد ما نمی‌خورند و فقط داده را کثیف می‌کنند.

**یکی‌کردن خانه و حیاط**
باید دقت کنیم:
بعضی خانه‌ها حیاط جداگانه با خط مجزا دارند؛ در این موارد باید خانه و حیاط را یکی کنیم.
برای این کار:
### ·       دستور Explode را می‌زنیم.
### ·       خطوط اضافی را پاک می‌کنیم تا یک پارسل واحد داشته باشیم.

**شماره‌گذاری پارسل‌ها برای برداشت**
برای برداشت میدانی، پلاک‌ها بهتر است شماره داشته باشند تا برداشتگر دچار خطا نشود.

## 6-  نصب Lisp شماره‌گذاری
برای شماره زدن پارسل‌ها:
در گوگل سرچ می‌کنیم:
### ·       numinc lisp
### ·         وارد سایت Incremental Numbering Suite می‌شویم.
### ·         فایل LSP را دانلود می‌کنیم.
### ·         در AutoCAD دستور APPLOAD را می‌زنیم.
### ·         فایل Lisp را Load می‌کنیم.
بعد از این مرحله، دستور NUMINC به AutoCAD اضافه می‌شود.

## 7-  شماره‌گذاری پارسل‌ها با NUMINC

### ·       دستور NUMINC را تایپ می‌کنیم.
### ·       یک پنجره باز می‌شود.
مشخص می‌کنیم شماره:
### ·       پیشوند داشته باشد یا
### ·       پسوند داشته باشد (مثلاً: P1)
### ·       داخل پنجره روی Build کلیک می‌کنیم.
### ·       متنی که به‌صورت پیش‌فرض نوشته شده را Remove می‌کنیم.
### ·       در کادر بالا عدد 1 را وارد می‌کنیم.
### ·       Add می‌کنیم و OK می‌زنیم.
### ·       شروع می‌کنیم به ترتیب روی پارسل‌ها کلیک کردن تا شماره‌گذاری کامل شود.

## 8-  جدا کردن بلوک برای GIS

### ·       کل بلوک را انتخاب می‌کنیم.
### ·       Copy می‌کنیم.
### ·       یک فایل AutoCAD جدید باز می‌کنیم.
### ·       از نوار ابزار Paste را می‌زنیم.
### ·       نوع Paste را می‌گذاریم روی: Paste to Original Coordinates

**علت این کار این است که:**
در فایل اصلی ممکن است عوارض اضافی در جاهای دیگر وجود داشته باشد.
ما فقط بلوک تمیزشده را می‌خواهیم.

در نهایت فایل را Save می‌کنیم تا آن را وارد GIS کنیم.

## 9-  ورود داده‌ها به GIS
GIS با فایل CAD مثل یک Folder برخورد می‌کند، چون:

یک لایه نمی‌تواند هم‌زمان نقطه، خط و پلیگون باشد.

بنابراین:
### ·       تمام لایه‌ها را Add می‌کنیم.
فقط این دو مورد را روشن می‌گذاریم:
### ·       Polyline
### ·       Annotation

## 10-  تبدیل Annotation و Polyline

### ·       روی لایه Polyline راست‌کلیک می‌کنیم.
### ·       ابزار Feature To Point را اجرا می‌کنیم.
### ·       Input Feature: Annotation
### ·       سپس ابزار Feature To Polygon را اجرا می‌کنیم.
### ·       Input Feature: Polyline
### ·       از خروجی Polyline و To Point، Export Feature می‌گیریم.
### ·       وارد بخش Environment می‌شویم.
### ·       سیستم مختصات را تنظیم می‌کنیم روی: EPSG: 32639

**لایه‌های نهایی**
بعد از این مرحله:
Polyline → Polygon (پارسل‌ها)
To Point → Label Feature (شماره پلاک‌ها)

**نکته مهم درباره بسته نبودن خطوط**
اگر پلی‌لاین‌ها بسته نبودند:
### ·       وارد Environment می‌شویم.
### ·       مقدار Tolerance را مثلاً روی 0.45 تنظیم می‌کنیم.
### ·       این کار کمک می‌کند پلیگون‌ها به‌درستی ساخته شوند.
این نکته برای بقیه تبدیل‌ها هم صدق می‌کند.
