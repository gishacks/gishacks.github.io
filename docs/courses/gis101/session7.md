---
title: جلسه ۷-تحلیل موقعیت لایه‌ها

# جلسات 20 و 25 آبان: استفاده از ابزار Join

ابزار Join، اتریبیوت لایه‌ها را به یکدیگر منتقل می‌کند. برای جوین کردن نیاز به یک عامل مشترک بین دو جدول داریم؛ این عامل مشترک می‌تواند هم اتریبیوت باشد و هم لوکیشن یا به عنوان مثال موقعیت جغرافیایی آنها روی هم قرار گرفته باشد.

## 1-   آماده‌سازی جدول در اکسل

### ·       پیوت‌تیبل را انتخاب و کپی می‌کنیم.

### ·       یک فایل اکسل جدید باز می‌کنیم.

### ·       روی سلول A1 راست‌کلیک و Paste Values را انتخاب می‌کنیم تا جدول به داده‌های خام تبدیل شود.

**باید مطمئن شویم که:**
### ·       جدول از A1 شروع ‌شود (باید A1 پر شود).

### ·       سطر اول حتماً شامل نام ستون‌ها باشد.

نام ستون‌ها را مطابق نیاز قرار می‌دهیم:

### ·       ستون اول: nid

### ·       ستون دوم: rest

### ·       ستون سوم: harim

### ·       ستون چهارم: total

فایل را ذخیره می‌کنیم با فرمت Excel 97-2003 (برای سازگاری با بعضی نسخه‌های GIS)

## 2-   آماده‌سازی لایه‌ها در GIS
فقط لایه محلات را فعال نگه می‌داریم و بقیه لایه‌ها را خاموش می‌کنیم تا کار راحت‌تر باشد.

### ·       از منوی Add Data، فایل اکسل را باز می‌کنیم.

### ·       جدول مورد نظر را Add می‌کنیم تا به پروژه اضافه شود.

### ·       وقتی جدول اضافه شد، روی آن راست کلیک می‌کنیم و Export   می‌گیریم تا یک جدول محلی ایجاد کنیم. (این قدم برای ایمن‌سازی جدول مفید است.)

## 3-   انجام Join بر پایه Attribute
ابتدا باید بررسی کنیم که بین دو جدول **یک فیلد مشترک** وجود دارد:

### ·       در لایه محلات: فیلد id با نام mah id 

### ·       در جدول: فیلد id با نام nid

### ·       سپس روی لایه جدول محلات راست کلیک کرده و وارد قسممت Join and Relates شده و Add Join را انتخاب می‌کنیم.

تنظیمات:
### ·       Input Table (لایه مقصد): محلات

### ·       Input Join Field (فیلد مشترک در لایه مقصد): mah id

### ·       Join Table (جدول مبدا): جدول جدید (تیبل اکسپورت شده)

### ·       Join Table Field (فیلد مشترک در جدول مبدا): nid

### ·       اگر Join برقرار نشد: باید به بخش بعدی (Validate Join) رجوع کنیم.

## 4-   دائمی کردن فیلدهای جوین شده
دو راه برای این امر وجود دارد؛ اولین راه اضافه کردن فیلد جدید و نگه داشتن فیلدی که به آن نیاز داریم (در اینجا فیلد درصد حریم‌ها)، و دومین راه اکسپورت گرفتن از جدول است که ترجیح نیست.

**اگر بخواهیم فقط چند فیلد پیوندی را نگه داریم و دائمی کنیم (مثل درصد حریم):**

### ·       در لایه محلات به Attribute Table می‌رویم.

### ·       Add Field را می‌زنیم و یک فیلد جدید می‌سازیم. 

### ·       فرمت فیلد را روی Percentage می‌گذاریم.

وقتی فیلد جدید اضافه شد:
### ·        روی فیلد راست‌کلیک کرده و Calculate data را انتخاب می‌کنیم. 

### ·       در پنجره Calculate Field، مقدار را از فیلد مربوطه (مثلاً harim از جدول جوین‌شده) انتخاب می‌کنیم تا مقادیر به فیلد جدید منتقل شوند.

### ·       پس از محاسبه، اگر نیاز نیست بقیه جوین‌ها باقی بمانند، روی لایه محلات راست‌کلیک می‌کنیم و وارد Join and Relates می‌شویم و گزینه Remove all joins را انتخاب می‌کنیم تا حذف شوند و فیلد جدید به صورت مستقل در جدول محلات باقی بماند.

## 5-   ساخت نقشه محلات آسیب‌پذیر

### ·       وارد بخش سیمبولوژی شده و از Graduated Colors استفاده و فیلد حریم را انتخاب ‌می‌کنیم.

### ·       برای ادغام Base map و نقشه ایجاد شده از قسمت Blend استفاده می‌کنیم

### ·       در ادامه وارد تب Feature layers شده و Multiply را می‌زنیم.

## 6-   استفاده از Spatial Join
در این نوع جوین، عامل مشترک بین دو لایه ما موقعیت مکانی آنهاست.
**درادامه، می‌خواهیم بررسی کنیم که در هر محله چه تعداد بیمارستان وجود دارد.**
### ·       روی لایه محلات راست‌کلیک می‌کنیم و از بخش Join and Relates گزینه Add Spatial Join را انتخاب می‌کنیم.

تنظیمات:

### ·       لایه مقصد: محلات

### ·        لایه مبدا: بیمارستان‌ها

### ·       Match Option: روی INTERSECT می‌گذاریم.

پس از Spatial Join، یک فیلد خودکار به نام join_count ایجاد می‌شود که تعداد بیمارستان در هر محله را نشان می‌دهد.

دائمی‌کردن تعداد بیمارستان‌ها:
### ·       در جدول محلات، Add Field می‌زنیم و یک فیلد جدید می‌سازیم. (مثلاً: hospital).

### ·       روی فیلد جدید راست‌کلیک می‌کنیم و Calculate data می‌زنیم.

### ·       در پنجره Calculate data از join_count استفاده می‌کنیم.

### ·       در آخر Remove all joins را طبق مراحل قبل می‌زنیم تا فیلد جدید مستقل شود.

**حال می‌خواهیم بررسی کنیم که در هر محله چه جمعیتی قرار دارد.**
مراحل مانند آموزش قبلی است اما با این تفاوت:

در مرحله تنظیم Spatial Join، input همان لایه جمعیت است؛ در ادامه وارد بخش Field می‌شویم و همه را به جز فیلد مورد نظر که به نام Jamiat هست، ریمو می‌کنیم و نوعش را SUM انتخاب می‌کنیم. (مجموع جمعیت هر محله)
در آخر طبق مراحل قبل، فیلد مورد نظر را دائمی می‌کنیم.

**اگر بخواهیم محله‌های بحرانی را پیدا کنیم:**
شاخص‌های بحرانی‌ترین محله:
### ·       حریم گسل: بیشترین

### ·       تعداد بیمارستان: کمترین

### ·       تراکم جمعیت: بیشترین
برای تحلیل بحرانی‌ترین محله باید برای هر شاخص نقشه جداگانه درست کنیم.
برای هر شاخص مراحل زیر را تکرار می‌کنیم:

### ·       روی لایه محلات راست‌کلیک: Symbology

### ·        نوع نقشه: Graduated Colors

### ·       فیلد مورد نظر را در هر نقشه انتخاب می‌کنیم.

### ·       از طیف رنگی یکسان استفاده می‌کنیم تا همه نقشه‌ها قابل مقایسه باشند.

### ·       در آخر برای بهتر دیده شدن و تحلیل، Transparency را تنظیم می‌کنیم.---
